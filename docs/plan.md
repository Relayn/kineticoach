# ⚜️ План проекта: ИИ-Фитнес Ассистент (Портфолио-версия)

## 1. Цель Проекта

*   **Проблема:** Новички, тренирующиеся дома, часто выполняют упражнения с неправильной техникой, что не только снижает эффективность, но и может привести к травмам.
*   **Решение:** Мы создаем Full-Stack приложение в виде Telegram Mini App, которое в реальном времени анализирует технику выполнения приседаний и дает мгновенную аудиовизуальную обратную связь для ее коррекции.
*   **Цели для Портфолио:** Этот проект продемонстрирует следующие ключевые компетенции:
    1.  **Real-Time Systems:** Умение строить системы с низкой задержкой на основе WebSockets.
    2.  **Computer Vision:** Практическое применение MediaPipe для анализа человеческой позы.
    3.  **Full-Stack Development:** Создание и интеграция современного Frontend (React) и Backend (Python) приложения.

## 2. Ключевые Требования

### 2.1. Функциональные Требования (MVP)
*   **Запуск:** Пользователь инициирует сессию через команду в Telegram-боте, который открывает интерфейс Mini App.
*   **Доступ к камере:** Mini App запрашивает и получает доступ к фронтальной камере устройства.
*   **Анализ в реальном времени:** Система непрерывно анализирует видеопоток, подсчитывая количество повторений и отслеживая технику в каждом из них.
*   **Детекция ошибок:** Алгоритм должен распознавать 5 ключевых ошибок приседаний (на основе эталонного видео):
    1.  Наклон корпуса вперед (`BEND FORWARD`).
    2.  Избыточный прогиб назад (`BEND BACKWARDS`).
    3.  Недостаточная глубина седа (`LOWER YOUR HIPS`).
    4.  Избыточная глубина седа (`SQUAT TOO DEEP`).
    5.  Колени выходят за носки (`KNEE FALLING OVER TOE`).
*   **Мгновенная обратная связь (Комбо):** Сразу после завершения каждого повторения с ошибкой, Mini App предоставляет:
    *   **Визуальную подсказку** (текст или иконка на экране).
    *   **Аудио подсказку** (короткая голосовая фраза).
*   **Итоговый отчет:** После завершения тренировки (например, по нажатию кнопки "Стоп"), на экране Mini App отображается краткий отчет: общее количество повторений, количество правильных и количество повторений с каждой из ошибок.

### 2.2. Нефункциональные Требования
*   **Производительность:** Задержка между завершением повторения и получением обратной связи не должна превышать **2-3 секунды**.
*   **Надежность:** Приложение должно стабильно работать локально через Docker Compose.
*   **Безопасность:** Соответствие OWASP Top 10. Так как система stateless, основной фокус на безопасности зависимостей (`pip-audit`, `npm audit`) и предотвращении уязвимостей в коде (`bandit`).

## 3. Предлагаемая Архитектура

### 3.1. Архитектурный Подход
**Двухкомпонентная Full-Stack архитектура:**
1.  **Frontend (Клиент):** **Telegram Mini App**, разработанное на **React**. Отвечает за интерфейс, доступ к камере и установку постоянного **WebSocket-соединения** с бэкендом.
2.  **Backend (Сервер):** **Python-приложение** (на FastAPI для асинхронной работы), которое принимает видеопоток по WebSocket, обрабатывает его с помощью **MediaPipe**, применяет систему правил и отправляет команды для обратной связи обратно на фронтенд.

### 3.2. Ключевые Сущности (Модель Данных)
Система является **stateless** (не хранит состояние между сессиями). Обмен данными будет происходить через WebSocket в формате JSON. Ключевые структуры данных:
*   `PoseData (Client -> Server)`: Сообщение, содержащее кадр видео или массив координат ключевых точек.
*   `FeedbackCommand (Server -> Client)`: Команда, содержащая тип ошибки и текст для озвучки/отображения.
*   `FinalReport (Server -> Client)`: Итоговая статистика по завершении сессии.

### 3.3. Границы системы и API
Основной интерфейс взаимодействия — **WebSocket API**. Бэкенд предоставляет один эндпоинт (например, `/ws/analysis`), к которому подключается Mini App для двунаправленного обмена сообщениями в реальном времени.

## 4. Технологический Стек и Инструменты

| Категория | Backend (Python) | Frontend (React) |
| :--- | :--- | :--- |
| **Язык** | Python 3.11+ | TypeScript |
| **Фреймворк** | FastAPI | React |
| **Real-Time** | Встроенная поддержка WebSockets | `socket.io-client` или нативный WebSocket |
| **Computer Vision**| MediaPipe | - |
| **Профиль Качества**| **"Production-Ready"** | **"Production-Ready"** |
| **Линтинг** | `Ruff` | `ESLint` |
| **Форматирование**| `Ruff` (Black-совместимый) | `Prettier` |
| **Типизация** | `mypy` (strict) | `TypeScript` (strict) |
| **Тестирование** | `Pytest` + `pytest-cov` | `Jest` + `React Testing Library` |
| **Безопасность** | `bandit`, `pip-audit` | `npm audit`, `eslint-plugin-security` |
| **Автоматизация**| `pre-commit` | `Husky` + `lint-staged` |
| **Развертывание**| **Docker** | Сборка в статику и обслуживание через Backend |

## 5. Предположения, Риски и Открытые Вопросы

*   **Предположения:**
    *   Выбранные на YouTube видео от сертифицированного тренера являются качественными, сняты с одного ракурса и достаточны для калибровки 5 ключевых ошибок.
    *   Ваш локальный компьютер обладает достаточной мощностью для запуска Docker-контейнеров и обработки видеопотока в реальном времени без значительных задержек.
*   **Риски Технические:**
    *   **Риск Калибровки (Высокий):** Получение точных и стабильных пороговых значений углов из видео разных людей (даже если это один тренер) — самая сложная задача. Алгоритм может требовать тонкой ручной настройки.
    *   **Риск Производительности:** Обработка видеопотока — ресурсоемкая задача. Возможны задержки, которые могут нарушить ощущение "real-time".
    *   **Риск Изучения React (Средний):** Так как это будет ваш первый проект на React, разработка фронтенда может занять больше времени, чем предполагается. Важно заложить на это дополнительный буфер.
*   **Открытые вопросы (Ключевые решения в процессе):**
    1.  Какой именно YouTube-канал/тренер будет выбран как единственный "источник правды"?
    2.  Как будет выглядеть UI/UX для отображения ошибок и итогового отчета в Mini App? (Нужно будет спроектировать простой макет).

## 6. Стратегия Реализации

### 6.1. Определение MVP
Создать и запустить локально Full-Stack приложение, состоящее из Telegram-бота, который открывает Mini App. Mini App получает доступ к камере, транслирует видеопоток на Python-бэкенд, который анализирует технику приседаний на 5 ключевых ошибок и отправляет обратно аудиовизуальные подсказки после каждого повторения, а также итоговый отчет.

### 6.2. Критерии Готовности MVP (Definition of Done)
1.  Все функциональные требования MVP реализованы.
2.  Код на бэкенде и фронтенде проходит все проверки качества ("Production-Ready" профиль).
3.  Покрытие кода тестами для ключевой логики (анализ, компоненты UI) **не менее 80%**.
4.  Все приложение запускается одной командой (`docker-compose up`) на локальной машине.

### 6.3. Дорожная Карта (Возможное развитие после MVP)
*   **Этап 2 (Хранение данных):** Интеграция с БД (SQLite/PostgreSQL) для сохранения истории тренировок и создания профилей пользователей.
*   **Этап 3 (Расширение функционала):** Добавление анализа новых упражнений (отжимания, планка).
*   **Этап 4 (Геймификация):** Введение системы достижений, статистики прогресса.

### 6.4. Детальный План на Первый Этап (Спринт 1)
*   [ ] **Настройка Фундамента:**
    *   [ ] Инициализировать Backend-проект (Poetry) и Frontend-проект (Create React App + TypeScript).
    *   [ ] Настроить `pre-commit` и CI/CD (GitHub Actions) для обоих проектов.
    *   [ ] Создать `docker-compose.yml` для одновременного запуска обоих сервисов.
*   [ ] **Backend-разработка ("Мозг"):**
    *   [ ] Реализовать WebSocket-сервер на FastAPI.
    *   [ ] Написать черновую версию `pose_analyzer.py` для работы с потоком.
    *   [ ] **Провести калибровку:** На основе эталонных видео создать `rules.py` с пороговыми значениями для 5 ошибок.
    *   [ ] Написать unit-тесты для `rules.py`.
*   [ ] **Frontend-разработка (Mini App):**
    *   [ ] Создать основной компонент приложения с доступом к камере.
    *   [ ] Реализовать WebSocket-клиент для отправки видеопотока на бэкенд.
    *   [ ] Создать UI-компоненты для отображения подсказок и итогового отчета.
*   [ ] **Интеграция и Тестирование:**
    *   [ ] Обеспечить стабильный обмен данными между Frontend и Backend.
    *   [ ] Провести комплексное тестирование всего пайплайна на себе.
    *   [ ] Отладить и доработать логику на основе результатов тестов.
